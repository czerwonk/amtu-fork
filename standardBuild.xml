<target name="clean">
	<delete dir="${docDir}"/>
	<delete dir="${binDir}"/>
	<delete failonerror="false">
		<fileset dir="${basedir}">
			<exclude name="**/bin/**/*.class"/>
			<include name="**/*.class"/>
			<include name="*build.log"/>
			<include name="*TEST*.xml"/>
			<include name="*TEST*.txt"/>
			<include name="logging.log*"/>
		</fileset>
	</delete>
</target>
	
<target name="_init">
	<tstamp/>
	<record loglevel="warn"
		name="${basedir}/${DSTAMP}${TSTAMP}_${ant.project.name}_build.log"/>
	<echo message="Starting Log. Component=${ant.project.name} DebugMode=${debugMode}"/>
	<mkdir dir="${binDir}"/>
	<condition property="isInDebugMode">
		<equals arg1="on" arg2="${debugMode}"/>
	</condition>
</target>

<target name="_checkCompileDependencies" if="hasCompileDependencies">
	<antcall target="compileDependencies"/>
</target>

<target name="compile" depends="_init,_checkCompileDependencies">
	<javac destdir="${binDir}" classpathref="project.class.path" debug="${debugMode}" fork="yes">
		<src path="${srcDir}"/>
	</javac>
</target>
	
<target name="_checkArchiveDependencies" if="hasArchiveDependencies">
	<antcall target="archiveDependencies"/>
</target>

<target name="_jar" depends="compile, _copySourceForDebug">
	<jar jarfile="${jarFile}">
		<fileset dir="${basedir}" includes="${resourceSubDir}/**"/>
		<fileset dir="${binDir}" excludes="**/ejb/**"/>
		<fileset dir="${binDir}" includes="**/ejb/interfaces/*"/>
	</jar>
</target>

<target name="_copySourceForDebug" depends="compile" if="isInDebugMode">
	<copy todir="${binDir}">
		<fileset dir="${srcDir}">
			<include name="**/*.java"/>
			<exclude name="**/CVS/"/>
		</fileset>
	</copy>
</target>

<target name="archive" depends="_checkArchiveDependencies,_callJarTarget,_callEjbJarTarget,_callWarTarget,_callTestJarTarget">
</target>

<target name="_callJarTarget" if="requiresJar">
	<antcall target="_jar"/>
</target> 
<target name="_callEjbJarTarget" if="requiresEjbJar">
	<antcall target="_ejbJar"/>
</target> 
<target name="_callWarTarget" if="requiresWar">
	<antcall target="_war"/>
</target> 
<target name="_callTestJarTarget" if="requiresTestJar">
	<antcall target="_testJar"/>
</target> 

